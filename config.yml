# default configuration file for BulkMail Dancer App.
# additional and environment specific configurations should be done in YAML files
# in the "environments" directory. see the sample files:
# - environments/development.yml.sample
# - environments/production.yml.sample

appname: "BulkMail"

layout: "main"

charset: "UTF-8"

template: template_toolkit

session: "YAML"
session_dir: "/tmp/BulkMail-sessions"

server_tokens: false

sqlite:
    db: 'emails.db'
    insert: 'insert into mbox (key,ackkey,from_address,subject,date,content_type,body) values (?,?,?,?,?,?,?)'
    update_from: 'update mbox set new_from_address = ? where key = ?'
    update_rcpt: 'update mbox set recipients = ? where key = ?'

    poll_mailings: 'select * from mailings where status = 0'
    lock_mailing: 'update mailings set timestamp = ?, status = ? where key = ?'
    update_delivered: 'update mailings set delivered = ? where key = ?'
    update_failed: 'update mailings set failed = ? where key = ?'
    get_delivered: 'select delivered from mailings where key = ?'
    get_failed: 'select failed from mailings where key = ?'

    tables:
    - name: mbox
      schema: >
        CREATE TABLE IF NOT EXISTS mbox (
          key text primary key,
          ackkey text unique,
          from_address text,
          new_from_address text,
          subject text,
          date text,
          content_type text,
          body text,
          recipients text
        );
    - name: mailings
      schema: >
        CREATE TABLE IF NOT EXISTS mailings (
          key text primary key,
          timestamp text,
          delivered text,
          failed text,
          status int default 0,
          delivered bool default false
        );

